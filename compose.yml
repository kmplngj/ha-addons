services:
  pixoo-rest:
    build:
      context: ./pixoo-rest
      dockerfile: Dockerfile
      args:
        BUILD_FROM: ghcr.io/home-assistant/aarch64-base-python:3.13-alpine3.20
        BUILD_ARCH: aarch64
        BUILD_VERSION: dev
      platforms:
        - linux/arm64
    container_name: pixoo-rest
    ports:
      - "${PIXOO_REST_PORT:-5001}:5000"
    environment:
      # Device configuration
      PIXOO_HOST: ${PIXOO_HOST:-192.168.1.100}
      PIXOO_SCREEN_SIZE: ${PIXOO_SCREEN_SIZE:-64}
      
      # Debug settings
      PIXOO_DEBUG: ${PIXOO_DEBUG:-false}
      PIXOO_REST_DEBUG: ${PIXOO_REST_DEBUG:-false}
      
      # Connection settings
      PIXOO_CONNECTION_RETRIES: ${PIXOO_CONNECTION_RETRIES:-10}
      
      # Server configuration
      PIXOO_REST_HOST: 0.0.0.0
      PIXOO_REST_PORT: 5000
      
      # Timezone
      TZ: ${TZ:-Europe/Berlin}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "--fail", "--silent", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - pixoo-network

networks:
  pixoo-network:
    driver: bridge
